# Веб-сервис прогноза погоды для маршрута

Данное приложение позволяет построить маршрут между городами и узнать прогноз погоды в точках маршрута на 1 или 5 дней, а также визуализирует полученные данные на карте и графиках.

## Установка и запуск

1. Клонируйте репозиторий:

    ```bash
    git clone https://github.com/vlavrinov/project3
    ```

2. Установите необходимые библиотеки:

    ```bash
    pip install Flask requests dash plotly pandas
    ```

3. Получите API ключ от AccuWeather ([https://developer.accuweather.com/](https://developer.accuweather.com/)).

4. Вставьте ваш API ключ в файл `app.py` в переменную `API_KEY`.

5. Запустите приложение:

    ```bash
    python app.py
    ```

6. Откройте веб-браузер и перейдите по адресу [http://127.0.0.1:8050/](http://127.0.0.1:8050/).

## Функциональность

*   Пользователь вводит названия начального и конечного городов маршрута.
*   Пользователь может добавить промежуточные города (добавляются в середину маршрута).
*   Пользователь выбирает прогноз на 1 или 5 дней.
*   Сервис получает координаты городов с помощью AccuWeather Location API.
*   Сервис запрашивает данные о погоде для каждого города с помощью AccuWeather Forecast API.
*   Данные о погоде кэшируются для предотвращения повторных запросов.
*   Модель оценивает погодные условия на основе температуры, скорости ветра и количества осадков, добавляя к оценке дату.
*   Пользователю отображается следующая информация:
    *   Таблица с данными о погоде для всех городов и всех дней прогноза (температура, скорость ветра, осадки, иконка погоды).
    *   Карта с маркерами городов и линией маршрута.
    *   График температуры, скорости ветра или осадков для выбранного города и выбранного типа данных.
    *   Оценка погодных условий для каждого дня для выбранного города.

## Обработка ошибок

В рамках проекта обрабатываются следующие ошибки:

*   **Ошибка получения координат города:** Если AccuWeather Location API не может определить координаты города, пользователю выводится сообщение об ошибке.
*   **Ошибка запроса к AccuWeather Forecast API:** Если API недоступно, или произошла другая ошибка при запросе (например, превышен лимит запросов), пользователю выводится сообщение об ошибке.
*   **Ошибка обработки данных от API:** Если данные от API не содержат ожидаемых полей, пользователю выводится сообщение об ошибке.
*   **Ошибка ввода данных пользователем:** Если пользователь не ввел названия городов или ввел некорректные данные, ему выводится соответствующее сообщение об ошибке.

Все обработанные ошибки не приводят к падению приложения, а информируют пользователя о проблеме и предлагают ввести корректные данные или повторить попытку позже.

## Модель оценки погодных условий

Модель `check_bad_weather` оценивает погодные условия на основе следующих параметров:

*   **Температура:**
    *   Ниже -5°C или выше 30°C считается плохой погодой.
*   **Скорость ветра:**
    *   Скорость ветра выше 10 м/с считается плохой погодой.
*   **Осадки:**
    *   Наличие осадков считается плохой погодой.

Если хотя бы один из параметров не соответствует норме, добавляется соответствующая пометка к оценке погоды ("Ой-ой, погода плохая (параметр)"), также к оценке добавляется дата.

## Используемые библиотеки

*   **Flask:** Для создания веб-приложения.
*   **Requests:** Для отправки HTTP-запросов к AccuWeather API.
*   **Dash:** Для создания интерактивного веб-интерфейса.
*   **Plotly:** Для визуализации данных (графики и карты).
*   **Pandas:** Для обработки табличных данных.
*   **JSON:** Для работы с данными в формате JSON.

## Тестирование

Для проверки работоспособности сервиса можно выполнить следующие тесты:

**Юзкейс 1: Корректный ввод данных.**

*   **Входные данные:** "Moscow" в поле "Начальный город", "London" в поле "Конечный город", прогноз на 5 дней.
*   **Ожидаемый результат:** Страница с результатами, содержащая таблицу с информацией о погоде в Москве и Лондоне, карту с маршрутом, график температуры для Москвы и оценку погодных условий для Москвы на каждый день.

**Юзкейс 2: Некорректный ввод данных (несуществующий город).**

*   **Входные данные:** "Несуществующийгород" в поле "Начальный город", "Moscow" в поле "Конечный город".
*   **Ожидаемый результат:** Сообщение об ошибке "Не удалось определить местоположение города Несуществующийгород."

**Юзкейс 3: Добавление промежуточных городов.**

*   **Входные данные:** "Moscow" в поле "Начальный город", "London" в поле "Конечный город", нажать кнопку "Добавить промежуточный город", ввести "Bryansk".
*   **Ожидаемый результат:** Маршрут на карте изменится и будет проходить через Брянск, в таблице и списке городов для графика появится соответствующий город.